<html>
<head>
	<meta charset="UTF-8">
	<meta name="description" content="Convert between UTM and Latitude/Longitude, using any format">
	<meta name="keywords" content="online,convert,conversion,UTM,Latitude/Longitude,latlon,lat,long,long,gps,map,location,coordinate,map coordinate">

	<link rel="stylesheet" type="text/css" href="./css/geoparse.css">
	<script src=".\js\geoclasses.js"></script>
	<script src=".\js\geoconverter.js"></script>
	<script src=".\js\geoparse.js"></script>
	<script src=".\js\jquery-1.11.1.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
</head>
<body>
<div id="divAll">
	<div id="divPanel">
		<div id="divHeader"><span class="header">EARTH</span></div>
		<div id="divInput">
			<div style="float:left;">
		    	  Enter coordinate: <input id="txtCoordinate" style="width:200px" ><!--autofocus-->  
			</div>
			<div style="float:left;">
				  <button id="btnConvertUtm" class="rounded-corners" onclick="onClickConvertUtm()">Convert UTM</button>
				  <button id="btnConvertGeo" class="rounded-corners"  onclick="onClickConvertGeo()">Convert Lat/Long</button>
			</div>
			<div id="divMyLocation" style="float:right">
					<span id="sMyLocation"></span>
					<button id="btnAddMyPos" class="rounded-corners"  onclick="onClickAddMyPos()">Add my location</button>
			</div>
		</div>
		<div id="divTable">
			 <table id="posTable">
			  		 <thead>
			  		 <!--tr><th>Label</th><th>Latitude / longitude <button class="rounded-corners" style="float:right">C</button></th><th>UTM <button class="rounded-corners" style="float:right">C</button></th></tr-->
			  		 <tr><th>Label</th><th>Latitude / logingtude</th><th>UTM</th></tr>
					 </thead>
					 <tbody>
					 </tbody>
					 <tfoot>
			  		 <tr>
					 	 <td><button id="btnClear" class="rounded-corners" onclick="clearLocations()" >Clear</button> </td>
						 <td>
						 	 <select class="rounded-corners" >
							 		 <option>d°</option>
									 <option>d°m'</option>
									 <option selected>d°m's"</option>
							 </select>
							 <!-- ToDo: Ala http://proto.io/freebies/onoff/ -->
						 	 <input id="latlonOrderNE" type="checkbox" checked class="rounded-corners" value="posNE">N before E
						 </td>
						 <td>
							 <input id="utmOrderEN" type="checkbox" checked class="rounded-corners" value="posEN">E before N
						 </td>
					 </tr>
					 </tfoot>
				</table>
		 </div>
	</div>
	<div id="divMap">Map<div id="divMap2"></div></div>
</div>
<script type="text/javascript">
	var posArray = [{label:"Test1", src: "latlon", latlon: new geoLatLon(59,9), utm: new geoUtm(32, "V", 555555, 6666666)},
				{label:"Test2", src: "utm", latlon: new geoLatLon(59.234,9.345), utm: new geoUtm(32, "V", 5567554, 6001987)},
				];

	var initZoomLevel = 2;
	var firstZoomLevel = 7;
	
	var myLocation = undefined; // a geoLatLon object
	var markers;
	var map;

	function initialize() {
		initMap("divMap2");
		displayLocations();
	}
	function initMap(div) {
		var mapOptions = {
			zoom: initZoomLevel,
			center: new google.maps.LatLng(0, 0),
			mapTypeId: google.maps.MapTypeId.ROADMAP
		  };
		
		map = new google.maps.Map(document.getElementById(div), mapOptions);

		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function (location) {
				map.setCenter(new google.maps.LatLng(location.coords.latitude, location.coords.longitude));
				map.setZoom(firstZoomLevel);
				myLocation = new geoLatLon(location.coords.latitude, location.coords.longitude);
			});
		} 

	}

	
	function onClickConvertGeo() {
		var orgStr = $("#txtCoordinate").val();
		var latlon = geoparse.parseLatLon(orgStr);
		var utm = geoconverter.LatLonToUTM(latlon);
		
		addLocation(orgStr, latlon, utm);
	}
	function onClickConvertUtm() {
		var orgStr = $("#txtCoordinate").val();
		var utm = geoparse.parseUtm(orgStr);
		var latlon = geoconverter.UTMToLatLon(utm);
		
		addLocation(orgStr, latlon, utm);
	}
	
	
	// Ask browser for location
	function onClickAddMyPos() {
		var span = $("#sMyLocation");
		span.innerHTML = "";
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(showCurrentPosition);
		} else {
			span.innerHTML = "Geolocation is not supported by this browser.";
		}
	}
	function showCurrentPosition(location) {
		if (location == undefined) {
			var span = $("#sMyLocation");
			span.innerHTML = "Could not retrieve your location";
		} else {
			var orgStr = location.coords.latitude + " N " + location.coords.longitude + " E ";
			var latlon = new geoLatLon(location.coords.latitude, location.coords.longitude);
			var utm = geoconverter.LatLonToUTM(latlon);
			var label = "Here";
			addLocation(orgStr, latlon, utm, label);
		}
	}
				
	function addLocation(orgStr, latlon, utm, label) {
		var loc = {orgStr: orgStr, latlon: latlon, utm: utm, label: label};
		posArray.push(loc);
		displayLocations();
	}
	function editLocation(index) {
	}
	function clearLocations() {
		//for osArray = [];
		displayLocations()
	}
	
	function copyToClipboard(b, str) {
		alert("Str: '"+str+"'");
		
		var clip = new ClipboardEvent( 'copy' );
		clip.clipboardData.setData( 'text/plain', str);
		clip.preventDefault();
		
		b.target.dispatchEvent( clip );
		
	}

	function displayLocations() {
		generateTable();
		displayLocationsOnMap();
	}
	
	
	function displayLocationsOnMap() {
		if (map == undefined)
			initMap();
		
		for (var i=0; i<posArray.length; i++) {
			var pos = posArray[i];
			if (pos.marker == undefined) {
				var markerPos = new google.maps.LatLng(pos.latlon.lat, pos.latlon.lon);
				var markerOptions = {
										map:map,
										draggable:true,
										animation: google.maps.Animation.DROP,
										position: markerPos
									};
				
				marker = new google.maps.Marker(markerOptions);
				//google.maps.event.addListener(marker, 'click', toggleBounce);
				pos.marker = marker;
			}
		}
	}
	


	function generateTable() {
		var labelLetters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
		var tb = $("#posTable tbody");
		tb.empty();
		for (var i=0; i<posArray.length; i++) {
			var pos = posArray[i];
			var labelStr = (pos.label == undefined) ? labelLetters[i%labelLetters.length] : pos.label;
			var latlonStr = pos.latlon.toString();
			var utmStr = pos.utm.toString();
			
			tb.append("<tr><td>"+labelStr+"</td><td>"+latlonStr+"</td><td>"+utmStr+"</td></tr>");
		}
	}

	// Add on load event to initialize the whole shebang
	google.maps.event.addDomListener(window, 'load', initialize);
</script>
</body>
</html>
